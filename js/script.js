"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},window.cancelAnimFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitRequestCancelAnimationFrame||window.mozRequestCancelAnimationFrame||window.oRequestCancelAnimationFrame||window.msRequestCancelAnimationFrame||function(t){return clearTimeout(t)};var App={start:function(){this.originalSimonSounds={UL:164.814,UR:440,LL:277.18,LR:329.628},this.simonSwipeSounds={UL:523.251,UR:329.628,LL:261.63,LR:391.995},this.soundLib=this.simonSwipeSounds,this.stepsInGame=20,this.currentStep=1,this.currentNoteInStep=1,this.tempo=120,this.strictMode=!1,this.reactionDelay=1e3,this.messageError="!!",this.messageStop="--",this.messageWin="00",this.gameButtonNames=["UR","LR","LL","UL"],this.notesInQueue=[],this.lastNoteToDraw="",this.requestId=-1,this.playSequence=this.playSequence.bind(this),this.repeatSequence=this.repeatSequence.bind(this),this.playPhrase=this.playPhrase.bind(this),this.handleStart=this.handleStart.bind(this),this.playSound=this.playSound.bind(this),this.setStrictMode=this.setStrictMode.bind(this),this.handleGameState=this.handleGameState.bind(this),this.draw=this.draw.bind(this)},playSequence:function(t,e){var n=this;return log.debug("Playing sequence on step "+e),t.slice(0,e).forEach(function(t,e){n.notesInQueue.push({note:t,time:60*e/n.tempo+n.context.currentTime})}),log.debug(JSON.stringify(this.notesInQueue)),this.requestId=window.requestAnimFrame(this.draw),Promise.all(this.notesInQueue.map(function(t){return n.playInTimePromise(n.soundLib[t.note],t.time-n.context.currentTime)}))},playPhrase:function(t,n){var i=this;log.debug("Playing musical phrase");var s=0;t.forEach(function(t,e){console.log("note in phrase: "+t),"object"!==_typeof(t[0])?(i.playInTime(n[t[0]],s),i.notesInQueue.push({note:i.gameButtonNames[3<e?e%4:e],time:s+i.context.currentTime})):t[0].forEach(function(t){i.playInTime(n[t],s,s),i.notesInQueue.push({note:"ALL",time:s+i.context.currentTime})}),s+=t[1]}),this.requestId=window.requestAnimFrame(this.draw)},randomRange:function(t){return t[Math.floor(Math.random()*t.length)]},generateSequence:function(t){var i=this;log.debug("Generating sequence");var s=new Array(t).fill(void 0);return s.reduce(function(t,e,n){for(;t===(e=i.randomRange(Object.keys(i.soundLib))););return s[n]=e},""),s},handleWin:function(){this.playPhrase([["G1",.25],["C2",.25],["E2",.25],["G2",.5],["E2",.25],[["C2","E2","G2"],.5]],{G1:392,C2:523.251,E2:659.255,G2:783.99})},repeatSequence:function(){var e=this;this.pauseListen(),this.later(.5*this.reactionDelay,[this.sequence,this.currentStep]).then(function(t){return e.playSequence.apply(e,_toConsumableArray(t))}).then(function(){return e.resumeListen()})}},UI={listen:function(){var e=this;log.debug("Listening on UI"),this.soundButtons=document.querySelectorAll(".buttonGame"),this.repeatBtn=document.querySelector("#btnRepeat");var t=document.querySelector("#btnStart"),n=document.querySelector("#btnStrict");log.trace("Buttons selected:"),log.trace(this.soundButtons),t.addEventListener("click",this.handleStart),this.soundButtons.forEach(function(t){return t.addEventListener("click",e.handleGameState)}),this.repeatBtn.addEventListener("click",this.repeatSequence),n.addEventListener("click",this.setStrictMode),this.pauseListen()},pauseListen:function(){var e=this;log.debug("Pause listening on color buttons"),[].concat(_toConsumableArray(this.soundButtons),[this.repeatBtn]).forEach(function(t){return e.pauseListenElm(t)})},resumeListen:function(){var e=this;log.debug("Resume listening on color buttons"),[].concat(_toConsumableArray(this.soundButtons),[this.repeatBtn]).forEach(function(t){return e.resumeListenElm(t)})},pauseListenElm:function(t){t.classList.add("--noevents")},resumeListenElm:function(t){t.classList.remove("--noevents")},blinkAttr:function(t,e){t.classList.toggle(e),setTimeout(function(){return t.classList.toggle(e)},200)},changeStyle:function(t){var e=this.getNote({target:t});this.blinkAttr(t,"--blink-"+e)},getElementByName:function(t){return document.querySelector("#button_"+t)},getNote:function(t){return t.target.id.split("_")[1]},handleGameState:function(t){var e=this;this.playSound(t),this.pauseListen();var n=this.getNote(t);this.sequence[this.currentNoteInStep-1]===n?(log.debug("Bingo!"),this.currentNoteInStep===this.currentStep?this.currentStep===this.stepsInGame?(this.syncMessage(this.messageWin),this.later(this.reactionDelay).then(this.handleWin())):(this.currentStep+=1,this.currentNoteInStep=1,this.syncMessage(this.currentStep),this.later(this.reactionDelay,[this.sequence,this.currentStep]).then(function(t){return e.playSequence.apply(e,_toConsumableArray(t))}).then(function(){return e.resumeListen()})):(this.currentNoteInStep+=1,this.resumeListen())):(log.debug("Missed!"),this.syncMessage(this.messageError),this.strictMode?this.later(2*this.reactionDelay).then(function(){return e.handleStart()}):(this.currentNoteInStep=1,this.later(this.reactionDelay,[this.currentStep]).then(function(t){return e.syncMessage.apply(e,_toConsumableArray(t)),e.later(e.reactionDelay,[e.sequence,e.currentStep])}).then(function(t){return e.playSequence.apply(e,_toConsumableArray(t))}).then(function(){return e.resumeListen()})))},handleStart:function(e){var n=this;this.currentStep=1,this.currentNoteInStep=1,this.sequence=this.generateSequence(this.stepsInGame),this.syncMessage(this.messageStop),this.togglePressedState(e),this.later(this.reactionDelay,[this.currentStep]).then(function(t){return n.syncMessage.apply(n,_toConsumableArray(t)),[e]}).then(function(t){return n.togglePressedState.apply(n,_toConsumableArray(t)),n.later(n.reactionDelay,[n.sequence,n.currentStep])}).then(function(t){return n.playSequence.apply(n,_toConsumableArray(t))}).then(function(){return n.resumeListen()})},later:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return new Promise(function(t){return setTimeout(function(){return t([].concat(_toConsumableArray(n)))},e)})},playSound:function(t){log.debug("Play sound on a mouse click"),log.trace(t);var e=this.getNote(t);this.playSequence([e],1)},togglePressedState:function(t){t&&t.target.classList.toggle("--pressed")},setStrictMode:function(t){this.strictMode=!this.strictMode,this.togglePressedState(t)},syncMessage:function(t){document.querySelector("#messageElm").innerHTML=t},draw:function(){var e=this,t=this.context.currentTime,n=void 0;for(log.trace("Inside this.draw() notesInQueue: "+JSON.stringify(this.notesInQueue));0<this.notesInQueue.length&&this.notesInQueue[0].time<t;)n=this.notesInQueue[0].note,this.notesInQueue.splice(0,1);log.trace("Styling button; currentNote: "+n+", lastNote: "+this.lastNoteToDraw),void 0!==n&&this.lastNoteToDraw!==n&&("ALL"!==n?(this.changeStyle(this.getElementByName(n)),this.lastNoteToDraw=n):this.gameButtonNames.forEach(function(t){return e.changeStyle(e.getElementByName(t))})),this.requestId=window.requestAnimFrame(this.draw),0===this.notesInQueue.length&&(window.cancelAnimationFrame(this.requestId),this.lastNoteToDraw="",this.requestId=void 0)}},SoundGen={init:function(){this.context=new(window.AudioContext||window.webkitAudioContext)},setup:function(){this.oscillator=this.context.createOscillator(),this.gainNode=this.context.createGain(),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.context.destination),this.oscillator.type="sine"},playInTime:function(t,e){this.setup(),log.debug("Tone value: "+t),this.oscillator.frequency.setValueAtTime(t,this.context.currentTime+e),this.gainNode.gain.setValueAtTime(0,this.context.currentTime+e),this.gainNode.gain.linearRampToValueAtTime(1,this.context.currentTime+e+.01),this.oscillator.start(this.context.currentTime+e),this.stopAtTime(e),this.oscillator.onended=function(){return Promise.resolve()}},playInTimePromise:function(e,n){var i=this;return new Promise(function(t){i.setup(),log.debug("Tone value: "+e),i.oscillator.frequency.setValueAtTime(e,i.context.currentTime+n),i.gainNode.gain.setValueAtTime(0,i.context.currentTime+n),i.gainNode.gain.linearRampToValueAtTime(1,i.context.currentTime+n+.01),i.oscillator.start(i.context.currentTime+n),i.stopAtTime(n),i.oscillator.onended=function(){return t(e)}})},stopAtTime:function(t){this.gainNode.gain.exponentialRampToValueAtTime(.001,this.context.currentTime+t+1),this.oscillator.stop(this.context.currentTime+t+1)}};log.setLevel("debug"),Object.assign(App,SoundGen,UI),App.init(),App.start(),App.listen();
//# sourceMappingURL=script.js.map
