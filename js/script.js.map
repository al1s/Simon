{"version":3,"sources":["script.js"],"names":["window","requestAnimFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","cancelAnimFrame","cancelAnimationFrame","App","webkitCancelAnimationFrame","init","mozCancelAnimationFrame","originalSimonSounds","UL","msCancelAnimationFrame","UR","cancelRequestAnimationFrame","LL","webkitRequestCancelAnimationFrame","LR","mozRequestCancelAnimationFrame","oRequestCancelAnimationFrame","simonSwipeSounds","clearTimeout","id","this","stepsInGame","currentStep","tempo","notesInQueue","lastNote","sequence","generateSequence","playSound","log","debug","changeStyle","target","value","soundLib","play","playSequence","requestId","step","bind","time","trace","playInTime","e","JSON","stringify","Math","random","forEach","note","ndx","_this","push","context","currentTime","current","randomRange","prev","draw","arr","floor","length","_this2","SoundGen","start","Array","fill","undefined","AudioContext","oscillator","Object","keys","gainNode","frequency","setValueAtTime","webkitAudioContext","setup","stop","createOscillator","createGain","connect","destination","stopAtTime","gain","exponentialRampToValueAtTime","listen","buttons","document","querySelectorAll","linearRampToValueAtTime","addEventListener","btnPower","togglePressedState","elm","getElementByName","classList","toggle","currentNote","UI","_this3","btn","querySelector","name","splice","setLevel","assign"],"mappings":"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","file":"script.js","sourcesContent":["/* eslint no-var: 0 */\n/* eslint vars-on-top: 0 */\n/* eslint prefer-const: 0 */\n/* eslint arrow-parens: 0 */\n/* eslint no-restricted-syntax: 0 */\n\n/*\n  +(game engine) implement sequence generator;\n  (game engine) implement game loop;\n  (UI) add control panel;\n  +(UI) conditions to stop requestAnimationFrame loop;\n  (Improvement) add tempo control to UI;\n\n*/\n\n/* Notes and game flow\nTo implement accessible game I need to assing special keyboard layout\nto game process - map mouse gestures to keys;\n\nButtons in game:\nOn/Off\nRepeat\nStrict\n\nGame process:\n1. On Start game load the game engine.\n2. Choose a random sequence and keep it as current.\n3. Save current game position - 1. \n4. Play sequence from beginning to the current position inclusive.\n5. Wait for user input.\n6. Compare each entered element with corresponding element in sequence.\n7. On error: show message; buzz.\n8. On success: move current position one element right; repeat from step 3.\n8. On success in strict mode: repeat from step 2.\n*/\n\n/*\nUL: E -  164.814 (octave lower)\nUR: A -  440\nLL: C# - 277.18\nLR: E -  329.628\n*/\n\n// First, let's shim the requestAnimationFrame API, with a setTimeout fallback\nwindow.requestAnimFrame = (() => {\n  return (\n    window.requestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.oRequestAnimationFrame ||\n    window.msRequestAnimationFrame ||\n    (callback => window.setTimeout(callback, 1000 / 60))\n  );\n})();\n\nwindow.cancelAnimFrame = (() => {\n  return (\n    window.cancelAnimationFrame ||\n    window.webkitCancelAnimationFrame ||\n    window.mozCancelAnimationFrame ||\n    window.oCancelAnimationFrame ||\n    window.msCancelAnimationFrame ||\n    window.cancelRequestAnimationFrame ||\n    window.webkitRequestCancelAnimationFrame ||\n    window.mozRequestCancelAnimationFrame ||\n    window.oRequestCancelAnimationFrame ||\n    window.msRequestCancelAnimationFrame ||\n    (id => clearTimeout(id))\n  );\n})();\n\nvar App = {\n  init() {\n    this.originalSimonSounds = {\n      UL: 164.814,\n      UR: 440,\n      LL: 277.18,\n      LR: 329.628,\n    };\n    this.simonSwipeSounds = {\n      UL: 523.251, // 783.991 - original\n      UR: 329.628,\n      LL: 261.63,\n      LR: 391.995,\n    };\n    this.soundLib = this.simonSwipeSounds;\n    this.stepsInGame = 30;\n    this.currentStep = 1;\n    this.tempo = 160;\n    this.notesInQueue = [];\n    this.lastNote = '';\n    this.requestId = -1;\n    this.sequence = this.generateSequence(this.stepsInGame);\n    this.playSound = this.playSound.bind(this);\n  },\n\n  playSound(e) {\n    log.debug('Play sound on a mouse click');\n    log.trace(e);\n    this.changeStyle(e.target);\n    var value = this.soundLib[e.target.id.split('_')[1]];\n    this.play(value);\n  },\n\n  playSequence(sequence, step) {\n    log.debug(`Playing sequence on step ${step}`);\n    sequence.slice(0, step).forEach((note, ndx) => {\n      this.notesInQueue.push({\n        note,\n        time: ndx * 60 / this.tempo + this.context.currentTime,\n      });\n      this.playInTime(this.soundLib[note], ndx * 60 / this.tempo);\n    });\n    log.debug(JSON.stringify(this.notesInQueue));\n    this.requestId = window.requestAnimFrame(this.draw);\n  },\n\n  randomRange(arr) {\n    return arr[Math.floor(Math.random() * arr.length)];\n  },\n\n  generateSequence(length) {\n    log.debug('Generating sequence');\n    var sequence = new Array(length).fill(undefined);\n    sequence.reduce((prev, current, ndx) => {\n      do {\n        current = this.randomRange(Object.keys(this.soundLib));\n      } while (prev === current);\n      sequence[ndx] = current;\n      return current;\n    }, '');\n    return sequence;\n  },\n};\n\nvar SoundGen = {\n  start() {\n    this.context = new (window.AudioContext || window.webkitAudioContext)();\n  },\n\n  setup() {\n    this.oscillator = this.context.createOscillator();\n    this.gainNode = this.context.createGain();\n\n    this.oscillator.connect(this.gainNode);\n    this.gainNode.connect(this.context.destination);\n    this.oscillator.type = 'sine';\n  },\n\n  play(value) {\n    this.setup();\n    log.debug(`Tone value: ${value}`);\n    this.oscillator.frequency.setValueAtTime(value, this.context.currentTime);\n    this.gainNode.gain.setValueAtTime(0, this.context.currentTime);\n    this.gainNode.gain.linearRampToValueAtTime(\n      1,\n      this.context.currentTime + 0.01,\n    );\n    this.oscillator.start(this.context.currentTime);\n    this.stop();\n  },\n\n  playInTime(value, time) {\n    this.setup();\n    log.debug(`Tone value: ${value}`);\n    this.oscillator.frequency.setValueAtTime(\n      value,\n      this.context.currentTime + time,\n    );\n    this.gainNode.gain.setValueAtTime(0, this.context.currentTime + time);\n    this.gainNode.gain.linearRampToValueAtTime(\n      1,\n      this.context.currentTime + time + 0.01,\n    );\n    this.oscillator.start(this.context.currentTime + time);\n    this.stopAtTime(time);\n  },\n\n  stop() {\n    this.gainNode.gain.exponentialRampToValueAtTime(\n      0.001,\n      this.context.currentTime + 1,\n    );\n    this.oscillator.stop(this.context.currentTime + 1);\n  },\n\n  stopAtTime(time) {\n    this.gainNode.gain.exponentialRampToValueAtTime(\n      0.001,\n      this.context.currentTime + time + 1,\n    );\n    this.oscillator.stop(this.context.currentTime + time + 1);\n  },\n};\n\nvar UI = {\n  listen() {\n    log.debug('Listening on UI');\n    var buttons = document.querySelectorAll('.buttonGame');\n    var btnPower = document.querySelector('#btnPower');\n    log.trace('Buttons selected:');\n    log.trace(buttons);\n    buttons.forEach(btn => btn.addEventListener('click', this.playSound));\n    btnPower.addEventListener('click', this.togglePressedState);\n    this.draw = this.draw.bind(this);\n  },\n\n  changeStyle(elm) {\n    elm.classList.toggle('--blink');\n    setTimeout(() => elm.classList.toggle('--blink'), 300);\n  },\n\n  getElementByName(name) {\n    return document.querySelector(`#button_${name}`);\n  },\n\n  togglePressedState(e) {\n    e.target.classList.toggle('--pressed');\n  },\n\n  draw() {\n    var currentTime = this.context.currentTime;\n    var currentNote;\n    log.debug(\n      `Inside this.draw() notesInQueue: ${JSON.stringify(this.notesInQueue)}`,\n    );\n    while (\n      this.notesInQueue.length > 0 &&\n      this.notesInQueue[0].time < currentTime\n    ) {\n      currentNote = this.notesInQueue[0].note;\n      this.notesInQueue.splice(0, 1);\n    }\n\n    log.debug(`currentNote: ${currentNote}, lastNote: ${this.lastNote}`);\n    if (currentNote !== undefined && this.lastNote !== currentNote) {\n      this.changeStyle(this.getElementByName(currentNote));\n      this.lastNote = currentNote;\n    }\n    this.requestId = window.requestAnimFrame(this.draw);\n    if (this.notesInQueue.length === 0) {\n      window.cancelAnimationFrame(this.requestId);\n      this.requestId = undefined;\n    }\n  },\n};\n\nlog.setLevel('debug');\nObject.assign(App, SoundGen, UI);\nApp.init();\nApp.start();\nApp.listen();\n"],"sourceRoot":"/source/"}